(function(){"use strict";var S=(t=>(t.Clockwise="clockwise",t.CounterClockwise="counter-clockwise",t))(S||{}),f=(t=>(t.Relative="relative",t.Absolute="absolute",t))(f||{}),q=typeof global=="object"&&global&&global.Object===Object&&global,B=q,Q=typeof self=="object"&&self&&self.Object===Object&&self,W=B||Q||Function("return this")(),z=W,V=z.Symbol,h=V,G=Object.prototype,tt=G.hasOwnProperty,et=G.toString,y=h?h.toStringTag:void 0;function rt(t){var e=tt.call(t,y),r=t[y];try{t[y]=void 0;var n=!0}catch{}var a=et.call(t);return n&&(e?t[y]=r:delete t[y]),a}var nt=Object.prototype,at=nt.toString;function it(t){return at.call(t)}var ot="[object Null]",st="[object Undefined]",N=h?h.toStringTag:void 0;function $(t){return t==null?t===void 0?st:ot:N&&N in Object(t)?rt(t):it(t)}function T(t){return t!=null&&typeof t=="object"}var ct="[object Symbol]";function C(t){return typeof t=="symbol"||T(t)&&$(t)==ct}function ut(t,e){for(var r=-1,n=t==null?0:t.length,a=Array(n);++r<n;)a[r]=e(t[r],r,t);return a}var lt=Array.isArray,_=lt,ft=1/0,F=h?h.prototype:void 0,j=F?F.toString:void 0;function R(t){if(typeof t=="string")return t;if(_(t))return ut(t,R)+"";if(C(t))return j?j.call(t):"";var e=t+"";return e=="0"&&1/t==-ft?"-0":e}function m(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}function ht(t){return t}var pt="[object AsyncFunction]",dt="[object Function]",gt="[object GeneratorFunction]",vt="[object Proxy]";function yt(t){if(!m(t))return!1;var e=$(t);return e==dt||e==gt||e==pt||e==vt}var _t=z["__core-js_shared__"],A=_t,D=function(){var t=/[^.]+$/.exec(A&&A.keys&&A.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function bt(t){return!!D&&D in t}var mt=Function.prototype,xt=mt.toString;function wt(t){if(t!=null){try{return xt.call(t)}catch{}try{return t+""}catch{}}return""}var Pt=/[\\^$.*+?()[\]{}|]/g,Ot=/^\[object .+?Constructor\]$/,St=Function.prototype,zt=Object.prototype,$t=St.toString,Tt=zt.hasOwnProperty,Ct=RegExp("^"+$t.call(Tt).replace(Pt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function At(t){if(!m(t)||bt(t))return!1;var e=yt(t)?Ct:Ot;return e.test(wt(t))}function It(t,e){return t==null?void 0:t[e]}function I(t,e){var r=It(t,e);return At(r)?r:void 0}function Et(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}var Mt=800,Gt=16,Nt=Date.now;function Ft(t){var e=0,r=0;return function(){var n=Nt(),a=Gt-(n-r);if(r=n,a>0){if(++e>=Mt)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}function jt(t){return function(){return t}}var Rt=function(){try{var t=I(Object,"defineProperty");return t({},"",{}),t}catch{}}(),x=Rt,Dt=x?function(t,e){return x(t,"toString",{configurable:!0,enumerable:!1,value:jt(e),writable:!0})}:ht,Ht=Dt,Ut=Ft(Ht),Lt=Ut,Kt=9007199254740991,Xt=/^(?:0|[1-9]\d*)$/;function H(t,e){var r=typeof t;return e=e??Kt,!!e&&(r=="number"||r!="symbol"&&Xt.test(t))&&t>-1&&t%1==0&&t<e}function kt(t,e,r){e=="__proto__"&&x?x(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r}function U(t,e){return t===e||t!==t&&e!==e}var Jt=Object.prototype,Yt=Jt.hasOwnProperty;function Zt(t,e,r){var n=t[e];(!(Yt.call(t,e)&&U(n,r))||r===void 0&&!(e in t))&&kt(t,e,r)}var L=Math.max;function qt(t,e,r){return e=L(e===void 0?t.length-1:e,0),function(){for(var n=arguments,a=-1,s=L(n.length-e,0),i=Array(s);++a<s;)i[a]=n[e+a];a=-1;for(var o=Array(e+1);++a<e;)o[a]=n[a];return o[e]=r(i),Et(t,this,o)}}var Bt=9007199254740991;function Qt(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=Bt}var Wt="[object Arguments]";function K(t){return T(t)&&$(t)==Wt}var X=Object.prototype,Vt=X.hasOwnProperty,te=X.propertyIsEnumerable,ee=K(function(){return arguments}())?K:function(t){return T(t)&&Vt.call(t,"callee")&&!te.call(t,"callee")},k=ee,re=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ne=/^\w*$/;function ae(t,e){if(_(t))return!1;var r=typeof t;return r=="number"||r=="symbol"||r=="boolean"||t==null||C(t)?!0:ne.test(t)||!re.test(t)||e!=null&&t in Object(e)}var ie=I(Object,"create"),b=ie;function oe(){this.__data__=b?b(null):{},this.size=0}function se(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var ce="__lodash_hash_undefined__",ue=Object.prototype,le=ue.hasOwnProperty;function fe(t){var e=this.__data__;if(b){var r=e[t];return r===ce?void 0:r}return le.call(e,t)?e[t]:void 0}var he=Object.prototype,pe=he.hasOwnProperty;function de(t){var e=this.__data__;return b?e[t]!==void 0:pe.call(e,t)}var ge="__lodash_hash_undefined__";function ve(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=b&&e===void 0?ge:e,this}function d(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}d.prototype.clear=oe,d.prototype.delete=se,d.prototype.get=fe,d.prototype.has=de,d.prototype.set=ve;function ye(){this.__data__=[],this.size=0}function w(t,e){for(var r=t.length;r--;)if(U(t[r][0],e))return r;return-1}var _e=Array.prototype,be=_e.splice;function me(t){var e=this.__data__,r=w(e,t);if(r<0)return!1;var n=e.length-1;return r==n?e.pop():be.call(e,r,1),--this.size,!0}function xe(t){var e=this.__data__,r=w(e,t);return r<0?void 0:e[r][1]}function we(t){return w(this.__data__,t)>-1}function Pe(t,e){var r=this.__data__,n=w(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this}function v(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}v.prototype.clear=ye,v.prototype.delete=me,v.prototype.get=xe,v.prototype.has=we,v.prototype.set=Pe;var Oe=I(z,"Map"),Se=Oe;function ze(){this.size=0,this.__data__={hash:new d,map:new(Se||v),string:new d}}function $e(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function P(t,e){var r=t.__data__;return $e(e)?r[typeof e=="string"?"string":"hash"]:r.map}function Te(t){var e=P(this,t).delete(t);return this.size-=e?1:0,e}function Ce(t){return P(this,t).get(t)}function Ae(t){return P(this,t).has(t)}function Ie(t,e){var r=P(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this}function g(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}g.prototype.clear=ze,g.prototype.delete=Te,g.prototype.get=Ce,g.prototype.has=Ae,g.prototype.set=Ie;var Ee="Expected a function";function E(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(Ee);var r=function(){var n=arguments,a=e?e.apply(this,n):n[0],s=r.cache;if(s.has(a))return s.get(a);var i=t.apply(this,n);return r.cache=s.set(a,i)||s,i};return r.cache=new(E.Cache||g),r}E.Cache=g;var Me=500;function Ge(t){var e=E(t,function(n){return r.size===Me&&r.clear(),n}),r=e.cache;return e}var Ne=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Fe=/\\(\\)?/g,je=Ge(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(Ne,function(r,n,a,s){e.push(a?s.replace(Fe,"$1"):n||r)}),e}),Re=je;function De(t){return t==null?"":R(t)}function O(t,e){return _(t)?t:ae(t,e)?[t]:Re(De(t))}var He=1/0;function M(t){if(typeof t=="string"||C(t))return t;var e=t+"";return e=="0"&&1/t==-He?"-0":e}function Ue(t,e){e=O(e,t);for(var r=0,n=e.length;t!=null&&r<n;)t=t[M(e[r++])];return r&&r==n?t:void 0}function Le(t,e){for(var r=-1,n=e.length,a=t.length;++r<n;)t[a+r]=e[r];return t}var J=h?h.isConcatSpreadable:void 0;function Ke(t){return _(t)||k(t)||!!(J&&t&&t[J])}function Y(t,e,r,n,a){var s=-1,i=t.length;for(r||(r=Ke),a||(a=[]);++s<i;){var o=t[s];e>0&&r(o)?e>1?Y(o,e-1,r,n,a):Le(a,o):n||(a[a.length]=o)}return a}function Xe(t){var e=t==null?0:t.length;return e?Y(t,1):[]}function ke(t){return Lt(qt(t,void 0,Xe),t+"")}function Je(t,e){return t!=null&&e in Object(t)}function Ye(t,e,r){e=O(e,t);for(var n=-1,a=e.length,s=!1;++n<a;){var i=M(e[n]);if(!(s=t!=null&&r(t,i)))break;t=t[i]}return s||++n!=a?s:(a=t==null?0:t.length,!!a&&Qt(a)&&H(i,a)&&(_(t)||k(t)))}function Ze(t,e){return t!=null&&Ye(t,e,Je)}function qe(t,e,r,n){if(!m(t))return t;e=O(e,t);for(var a=-1,s=e.length,i=s-1,o=t;o!=null&&++a<s;){var u=M(e[a]),p=r;if(u==="__proto__"||u==="constructor"||u==="prototype")return t;if(a!=i){var l=o[u];p=n?n(l,u,o):void 0,p===void 0&&(p=m(l)?l:H(e[a+1])?[]:{})}Zt(o,u,p),o=o[u]}return t}function Be(t,e,r){for(var n=-1,a=e.length,s={};++n<a;){var i=e[n],o=Ue(t,i);r(o,i)&&qe(s,O(i,t),o)}return s}function Qe(t,e){return Be(t,e,function(r,n){return Ze(t,n)})}var We=ke(function(t,e){return t==null?{}:Qe(t,e)}),Z=We;function Ve(t){const[,e,r=""]=t.trim().split(";",2)[0].split(/^([a-z][0-9]+)\s+/i);if(!/^(G|M)\d+$/.test(e))return null;const n={};for(const[,a,s]of r.matchAll(/([a-z])[ \t]*(-?(?:\d+(?:\.\d+)?|\.\d+))/ig))n[a.toLowerCase()]=Number(s);return{command:e.toUpperCase(),args:n}}function tr(t,e){const r=[],n=t.split(`
`);let a=f.Relative,s=f.Absolute;const i={x:0,y:0,z:0,e:0,filePosition:0},o={length:1,extrudeExtra:0,z:0};for(let u=0;u<n.length;u++){const{command:p,args:l}=Ve(n[u])??{};if(!p){i.filePosition+=n[u].length+1;continue}let c=null;switch(p){case"G0":case"G1":c=Z(l,["x","y","z","e"]);break;case"G2":case"G3":c={...Z(l,["x","y","z","e","i","j","r"]),direction:p==="G2"?S.Clockwise:S.CounterClockwise};break;case"G10":c={e:-o.length},o.z!==0&&(c.z=i.z+o.z);break;case"G11":c={e:o.length+o.extrudeExtra},o.z!==0&&(c.z=i.z-o.z);break;case"G90":s=f.Absolute;case"M82":a=f.Absolute,i.e=0;break;case"G91":s=f.Relative;case"M83":a=f.Relative;break;case"G92":a===f.Absolute&&(i.e=l.e??i.e),s===f.Absolute&&(i.x=l.x??i.x,i.y=l.y??i.y,i.z=l.z??i.z);break;case"M207":o.length=l.s??o.length,o.extrudeExtra=l.s??o.extrudeExtra,o.z=l.z??o.z;break}if(c){if(a===f.Absolute&&c.e!==void 0){const nr=c.e-i.e;i.e=c.e,c.e=nr}s===f.Relative&&(c.x!==void 0&&(c.x+=i.x),c.y!==void 0&&(c.y+=i.y),c.z!==void 0&&(c.z+=i.z)),i.x=c.x??i.x,i.y=c.y??i.y,i.z=c.z??i.z,c.filePosition=i.filePosition,r.push(Object.freeze(c))}u%Math.floor(n.length/100)===0&&e(i.filePosition),i.filePosition+=n[u].length+1}return e(i.filePosition),r}const er=t=>{const e={action:"progress",filePosition:t};self.postMessage(e)},rr=t=>{const e={action:"moves",moves:t};self.postMessage(e)};self.onmessage=t=>{const e=t.data;switch(e.action){case"parse":{const r=tr(e.gcode,er);rr(r);break}}}})();
